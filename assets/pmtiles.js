var w=Uint8Array,H=Uint16Array,$e=Int32Array,me=new w([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ye=new w([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ie=new w([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),pe=function(r,e){for(var t=new H(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var i=new $e(t[30]),n=1;n<30;++n)for(var a=t[n];a<t[n+1];++a)i[a]=a-t[n]<<5|n;return{b:t,r:i}},we=pe(me,2),xe=we.b,Fe=we.r;xe[28]=258,Fe[258]=28;var Ke=pe(ye,0),We=Ke.b,Q=new H(32768);for(var g=0;g<32768;++g){var M=(g&43690)>>1|(g&21845)<<1;M=(M&52428)>>2|(M&13107)<<2,M=(M&61680)>>4|(M&3855)<<4,Q[g]=((M&65280)>>8|(M&255)<<8)>>1}var P=(function(r,e,t){for(var n=r.length,i=0,a=new H(e);i<n;++i)r[i]&&++a[r[i]-1];var o=new H(e);for(i=1;i<e;++i)o[i]=o[i-1]+a[i-1]<<1;var s;if(t){s=new H(1<<e);var f=15-e;for(i=0;i<n;++i)if(r[i])for(var c=i<<4|r[i],u=e-r[i],l=o[r[i]-1]++<<u,h=l|(1<<u)-1;l<=h;++l)s[Q[l]>>f]=c}else for(s=new H(n),i=0;i<n;++i)r[i]&&(s[i]=Q[o[r[i]-1]++]>>15-r[i]);return s}),R=new w(288);for(var g=0;g<144;++g)R[g]=8;for(var g=144;g<256;++g)R[g]=9;for(var g=256;g<280;++g)R[g]=7;for(var g=280;g<288;++g)R[g]=8;var be=new w(32);for(var g=0;g<32;++g)be[g]=5;var je=P(R,9,1),_e=P(be,5,1),G=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},T=function(r,e,t){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&t},q=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},Ne=function(r){return(r+7)/8|0},Ve=function(r,e,t){return(t==null||t>r.length)&&(t=r.length),new w(r.subarray(e,t))},Je=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],p=function(r,e,t){var n=new Error(e||Je[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,p),!t)throw n;return n},Y=function(r,e,t,n){var i=r.length,a=0;if(!i||e.f&&!e.l)return t||new w(0);var o=!t,s=o||e.i!=2,f=e.i;o&&(t=new w(i*3));var c=function(fe){var de=t.length;if(fe>de){var ge=new w(Math.max(de*2,fe));ge.set(t),t=ge}},u=e.f||0,l=e.p||0,h=e.b||0,y=e.l,U=e.d,v=e.m,O=e.n,I=i*8;do{if(!y){u=T(r,l,1);var F=T(r,l+1,3);if(l+=3,F)if(F==1)y=je,U=_e,v=9,O=5;else if(F==2){var j=T(r,l,31)+257,ie=T(r,l+10,15)+4,ae=j+T(r,l+5,31)+1;l+=14;for(var Z=new w(ae),_=new w(19),x=0;x<ie;++x)_[Ie[x]]=T(r,l+x*3,7);l+=ie*3;for(var oe=G(_),Be=(1<<oe)-1,Pe=P(_,oe,1),x=0;x<ae;){var se=Pe[T(r,l,Be)];l+=se&15;var C=se>>4;if(C<16)Z[x++]=C;else{var A=0,S=0;for(C==16?(S=3+T(r,l,3),l+=2,A=Z[x-1]):C==17?(S=3+T(r,l,7),l+=3):C==18&&(S=11+T(r,l,127),l+=7);S--;)Z[x++]=A}}var le=Z.subarray(0,j),E=Z.subarray(j);v=G(le),O=G(E),y=P(le,v,1),U=P(E,O,1)}else p(1);else{var C=Ne(l)+4,K=r[C-4]|r[C-3]<<8,W=C+K;if(W>i){f&&p(0);break}s&&c(h+K),t.set(r.subarray(C,W),h),e.b=h+=K,e.p=l=W*8,e.f=u;continue}if(l>I){f&&p(0);break}}s&&c(h+131072);for(var ke=(1<<v)-1,Re=(1<<O)-1,N=l;;N=l){var A=y[q(r,l)&ke],z=A>>4;if(l+=A&15,l>I){f&&p(0);break}if(A||p(2),z<256)t[h++]=z;else if(z==256){N=l,y=null;break}else{var ce=z-254;if(z>264){var x=z-257,B=me[x];ce=T(r,l,(1<<B)-1)+xe[x],l+=B}var V=U[q(r,l)&Re],J=V>>4;V||p(3),l+=V&15;var E=We[J];if(J>3){var B=ye[J];E+=q(r,l)&(1<<B)-1,l+=B}if(l>I){f&&p(0);break}s&&c(h+131072);var he=h+ce;if(h<E){var ue=a-E,Se=Math.min(E,he);for(ue+h<0&&p(3);h<Se;++h)t[h]=n[ue+h]}for(;h<he;++h)t[h]=t[h-E]}}e.l=y,e.p=N,e.b=h,e.f=u,y&&(u=1,e.m=v,e.d=U,e.n=O)}while(!u);return h!=t.length&&o?Ve(t,0,h):t.subarray(0,h)},Ge=new w(0),qe=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&p(6,"invalid gzip data");var e=r[3],t=10;e&4&&(t+=(r[10]|r[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!r[t++]);return t+(e&2)},Qe=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},Xe=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&p(6,"invalid zlib data"),(r[1]>>5&1)==1&&p(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function Ye(r,e){return Y(r,{i:2},e,e)}function et(r,e){var t=qe(r);return t+8>r.length&&p(6,"invalid gzip data"),Y(r.subarray(t,-8),{i:2},new w(Qe(r)),e)}function tt(r,e){return Y(r.subarray(Xe(r),-4),{i:2},e,e)}function rt(r,e){return r[0]==31&&r[1]==139&&r[2]==8?et(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?Ye(r,e):tt(r,e)}var nt=typeof TextDecoder<"u"&&new TextDecoder,it=0;try{nt.decode(Ge,{stream:!0}),it=1}catch{}var at=Object.defineProperty,k=Math.pow,d=(r,e)=>at(r,"name",{value:e,configurable:!0}),m=(r,e,t)=>new Promise((n,i)=>{var a=f=>{try{s(t.next(f))}catch(c){i(c)}},o=f=>{try{s(t.throw(f))}catch(c){i(c)}},s=f=>f.done?n(f.value):Promise.resolve(f.value).then(a,o);s((t=t.apply(r,e)).next())});d((r,e)=>{let t=!1,n="",i=L.GridLayer.extend({createTile:d((a,o)=>{let s=document.createElement("img"),f=new AbortController,c=f.signal;return s.cancel=()=>{f.abort()},t||(r.getHeader().then(u=>{u.tileType===1?console.error("Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details."):u.tileType===2?n="image/png":u.tileType===3?n="image/jpeg":u.tileType===4?n="image/webp":u.tileType===5&&(n="image/avif")}),t=!0),r.getZxy(a.z,a.x,a.y,c).then(u=>{if(u){let l=new Blob([u.data],{type:n}),h=window.URL.createObjectURL(l);s.src=h,s.cancel=void 0,o(void 0,s)}}).catch(u=>{if(u.name!=="AbortError")throw u}),s},"createTile"),_removeTile:d(function(a){let o=this._tiles[a];o&&(o.el.cancel&&o.el.cancel(),o.el.width=0,o.el.height=0,o.el.deleted=!0,L.DomUtil.remove(o.el),delete this._tiles[a],this.fire("tileunload",{tile:o.el,coords:this._keyToTileCoords(a)}))},"_removeTile")});return new i(e)},"leafletRasterLayer");var ot=d(r=>(e,t)=>{if(t instanceof AbortController)return r(e,t);let n=new AbortController;return r(e,n).then(i=>t(void 0,i.data,i.cacheControl||"",i.expires||""),i=>t(i)).catch(i=>t(i)),{cancel:d(()=>n.abort(),"cancel")}},"v3compat"),Te=class{constructor(e){this.tilev4=d((t,n)=>m(this,null,function*(){if(t.type==="json"){let y=t.url.substr(10),U=this.tiles.get(y);if(U||(U=new ve(y),this.tiles.set(y,U)),this.metadata)return{data:yield U.getTileJson(t.url)};let v=yield U.getHeader();return(v.minLon>=v.maxLon||v.minLat>=v.maxLat)&&console.error(`Bounds of PMTiles archive ${v.minLon},${v.minLat},${v.maxLon},${v.maxLat} are not valid.`),{data:{tiles:[`${t.url}/{z}/{x}/{y}`],minzoom:v.minZoom,maxzoom:v.maxZoom,bounds:[v.minLon,v.minLat,v.maxLon,v.maxLat]}}}let i=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),a=t.url.match(i);if(!a)throw new Error("Invalid PMTiles protocol URL");let o=a[1],s=this.tiles.get(o);s||(s=new ve(o),this.tiles.set(o,s));let f=a[2],c=a[3],u=a[4],l=yield s.getHeader(),h=yield s?.getZxy(+f,+c,+u,n.signal);if(h)return{data:new Uint8Array(h.data),cacheControl:h.cacheControl,expires:h.expires};if(l.tileType===1){if(this.errorOnMissingTile)throw new Error("Tile not found.");return{data:new Uint8Array}}return{data:null}}),"tilev4"),this.tile=ot(this.tilev4),this.tiles=new Map,this.metadata=e?.metadata||!1,this.errorOnMissingTile=e?.errorOnMissingTile||!1}add(e){this.tiles.set(e.source.getKey(),e)}get(e){return this.tiles.get(e)}};d(Te,"Protocol");var yt=Te;function Le(r,e){return(e>>>0)*4294967296+(r>>>0)}d(Le,"toNum");function Ue(r,e){let t=e.buf,n=t[e.pos++],i=(n&112)>>4;if(n<128||(n=t[e.pos++],i|=(n&127)<<3,n<128)||(n=t[e.pos++],i|=(n&127)<<10,n<128)||(n=t[e.pos++],i|=(n&127)<<17,n<128)||(n=t[e.pos++],i|=(n&127)<<24,n<128)||(n=t[e.pos++],i|=(n&1)<<31,n<128))return Le(r,i);throw new Error("Expected varint not more than 10 bytes")}d(Ue,"readVarintRemainder");function D(r){let e=r.buf,t=e[r.pos++],n=t&127;return t<128||(t=e[r.pos++],n|=(t&127)<<7,t<128)||(t=e[r.pos++],n|=(t&127)<<14,t<128)||(t=e[r.pos++],n|=(t&127)<<21,t<128)?n:(t=e[r.pos],n|=(t&15)<<28,Ue(n,r))}d(D,"readVarint");function ee(r,e,t,n){if(n===0){t===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);let i=e[0];e[0]=e[1],e[1]=i}}d(ee,"rotate");function Ce(r,e){let t=k(2,r),n=e,i=e,a=e,o=[0,0],s=1;for(;s<t;)n=1&a/2,i=1&(a^n),ee(s,o,n,i),o[0]+=s*n,o[1]+=s*i,a=a/4,s*=2;return[r,o[0],o[1]]}d(Ce,"idOnLevel");var st=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Ee(r,e,t){if(r>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");if(e>k(2,r)-1||t>k(2,r)-1)throw new Error("tile x/y outside zoom level bounds");let n=st[r],i=k(2,r),a=0,o=0,s=0,f=[e,t],c=i/2;for(;c>0;)a=(f[0]&c)>0?1:0,o=(f[1]&c)>0?1:0,s+=c*c*(3*a^o),ee(c,f,a,o),c=c/2;return n+s}d(Ee,"zxyToTileId");function lt(r){let e=0;for(let t=0;t<27;t++){let n=(1<<t)*(1<<t);if(e+n>r)return Ce(t,r-e);e+=n}throw new Error("Tile zoom level exceeds max safe number limit (26)")}d(lt,"tileIdToZxy");var ct=(r=>(r[r.Unknown=0]="Unknown",r[r.None=1]="None",r[r.Gzip=2]="Gzip",r[r.Brotli=3]="Brotli",r[r.Zstd=4]="Zstd",r))(ct||{});function $(r,e){return m(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return rt(new Uint8Array(r));let t=new Response(r).body;if(!t)throw new Error("Failed to read response stream");let n=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}throw new Error("Compression method not supported")})}d($,"defaultDecompress");var ht=(r=>(r[r.Unknown=0]="Unknown",r[r.Mvt=1]="Mvt",r[r.Png=2]="Png",r[r.Jpeg=3]="Jpeg",r[r.Webp=4]="Webp",r[r.Avif=5]="Avif",r))(ht||{});function Me(r){return r===1?".mvt":r===2?".png":r===3?".jpg":r===4?".webp":r===5?".avif":""}d(Me,"tileTypeExt");var ut=127;function Ae(r,e){let t=0,n=r.length-1;for(;t<=n;){let i=n+t>>1,a=e-r[i].tileId;if(a>0)t=i+1;else if(a<0)n=i-1;else return r[i]}return n>=0&&(r[n].runLength===0||e-r[n].tileId<r[n].runLength)?r[n]:null}d(Ae,"findTile");var ft=class{constructor(e){this.file=e}getKey(){return this.file.name}getBytes(e,t){return m(this,null,function*(){return{data:yield this.file.slice(e,e+t).arrayBuffer()}})}};d(ft,"FileSource");var ze=class{constructor(e,t=new Headers){this.url=e,this.customHeaders=t,this.mustReload=!1;let n="";"navigator"in globalThis&&(n=globalThis.navigator.userAgent||"");let i=n.indexOf("Windows")>-1,a=/Chrome|Chromium|Edg|OPR|Brave/.test(n);this.chromeWindowsNoCache=!1,i&&a&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(e){this.customHeaders=e}getBytes(e,t,n,i){return m(this,null,function*(){let a,o;n?o=n:(a=new AbortController,o=a.signal);let s=new Headers(this.customHeaders);s.set("range",`bytes=${e}-${e+t-1}`);let f;this.mustReload?f="reload":this.chromeWindowsNoCache&&(f="no-store");let c=yield fetch(this.url,{signal:o,cache:f,headers:s});if(e===0&&c.status===416){let h=c.headers.get("Content-Range");if(!h||!h.startsWith("bytes */"))throw new Error("Missing content-length on 416 response");let y=+h.substr(8);c=yield fetch(this.url,{signal:o,cache:"reload",headers:{range:`bytes=0-${y-1}`}})}let u=c.headers.get("Etag");if(u!=null&&u.startsWith("W/")&&(u=null),c.status===416||i&&u&&u!==i)throw this.mustReload=!0,new X(`Server returned non-matching ETag ${i} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(c.status>=300)throw new Error(`Bad response code: ${c.status}`);let l=c.headers.get("Content-Length");if(c.status===200&&(!l||+l>t))throw a&&a.abort(),new Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield c.arrayBuffer(),etag:u||void 0,cacheControl:c.headers.get("Cache-Control")||void 0,expires:c.headers.get("Expires")||void 0}})}};d(ze,"FetchSource");var dt=ze;function b(r,e){let t=r.getUint32(e+4,!0),n=r.getUint32(e+0,!0);return t*k(2,32)+n}d(b,"getUint64");function De(r,e){let t=new DataView(r),n=t.getUint8(7);if(n>3)throw new Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:b(t,8),rootDirectoryLength:b(t,16),jsonMetadataOffset:b(t,24),jsonMetadataLength:b(t,32),leafDirectoryOffset:b(t,40),leafDirectoryLength:b(t,48),tileDataOffset:b(t,56),tileDataLength:b(t,64),numAddressedTiles:b(t,72),numTileEntries:b(t,80),numTileContents:b(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}d(De,"bytesToHeader");function te(r){let e={buf:new Uint8Array(r),pos:0},t=D(e),n=[],i=0;for(let a=0;a<t;a++){let o=D(e);n.push({tileId:i+o,offset:0,length:0,runLength:1}),i+=o}for(let a=0;a<t;a++)n[a].runLength=D(e);for(let a=0;a<t;a++)n[a].length=D(e);for(let a=0;a<t;a++){let o=D(e);o===0&&a>0?n[a].offset=n[a-1].offset+n[a-1].length:n[a].offset=o-1}return n}d(te,"deserializeIndex");var He=class extends Error{};d(He,"EtagMismatch");var X=He;function re(r,e){return m(this,null,function*(){let t=yield r.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");let n=t.data.slice(0,ut),i=De(n,t.etag),a=t.data.slice(i.rootDirectoryOffset,i.rootDirectoryOffset+i.rootDirectoryLength),o=`${r.getKey()}|${i.etag||""}|${i.rootDirectoryOffset}|${i.rootDirectoryLength}`,s=te(yield e(a,i.internalCompression));return[i,[o,s.length,s]]})}d(re,"getHeaderAndRoot");function ne(r,e,t,n,i){return m(this,null,function*(){let a=yield r.getBytes(t,n,void 0,i.etag),o=yield e(a.data,i.internalCompression),s=te(o);if(s.length===0)throw new Error("Empty directory is invalid");return s})}d(ne,"getDirectory");var gt=class{constructor(e=100,t=!0,n=$){this.cache=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=n}getHeader(e){return m(this,null,function*(){let t=e.getKey(),n=this.cache.get(t);if(n)return n.lastUsed=this.counter++,n.data;let i=yield re(e,this.decompress);return i[1]&&this.cache.set(i[1][0],{lastUsed:this.counter++,data:i[1][2]}),this.cache.set(t,{lastUsed:this.counter++,data:i[0]}),this.prune(),i[0]})}getDirectory(e,t,n,i){return m(this,null,function*(){let a=`${e.getKey()}|${i.etag||""}|${t}|${n}`,o=this.cache.get(a);if(o)return o.lastUsed=this.counter++,o.data;let s=yield ne(e,this.decompress,t,n,i);return this.cache.set(a,{lastUsed:this.counter++,data:s}),this.prune(),s})}prune(){if(this.cache.size>this.maxCacheEntries){let e=1/0,t;this.cache.forEach((n,i)=>{n.lastUsed<e&&(e=n.lastUsed,t=i)}),t&&this.cache.delete(t)}}invalidate(e){return m(this,null,function*(){this.cache.delete(e.getKey())})}};d(gt,"ResolvedValueCache");var Oe=class{constructor(e=100,t=!0,n=$){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=n}getHeader(e){return m(this,null,function*(){let t=e.getKey(),n=this.cache.get(t);if(n)return n.lastUsed=this.counter++,yield n.data;let i=new Promise((a,o)=>{re(e,this.decompress).then(s=>{s[1]&&this.cache.set(s[1][0],{lastUsed:this.counter++,data:Promise.resolve(s[1][2])}),a(s[0]),this.prune()}).catch(s=>{o(s)})});return this.cache.set(t,{lastUsed:this.counter++,data:i}),i})}getDirectory(e,t,n,i){return m(this,null,function*(){let a=`${e.getKey()}|${i.etag||""}|${t}|${n}`,o=this.cache.get(a);if(o)return o.lastUsed=this.counter++,yield o.data;let s=new Promise((f,c)=>{ne(e,this.decompress,t,n,i).then(u=>{f(u),this.prune()}).catch(u=>{c(u)})});return this.cache.set(a,{lastUsed:this.counter++,data:s}),s})}prune(){if(this.cache.size>=this.maxCacheEntries){let e=1/0,t;this.cache.forEach((n,i)=>{n.lastUsed<e&&(e=n.lastUsed,t=i)}),t&&this.cache.delete(t)}}invalidate(e){return m(this,null,function*(){let t=e.getKey();if(this.invalidations.get(t))return yield this.invalidations.get(t);this.cache.delete(e.getKey());let n=new Promise((i,a)=>{this.getHeader(e).then(o=>{i(),this.invalidations.delete(t)}).catch(o=>{a(o)})});this.invalidations.set(t,n)})}};d(Oe,"SharedPromiseCache");var vt=Oe,Ze=class{constructor(e,t,n){typeof e=="string"?this.source=new dt(e):this.source=e,n?this.decompress=n:this.decompress=$,t?this.cache=t:this.cache=new vt}getHeader(){return m(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(e,t,n,i){return m(this,null,function*(){let a=Ee(e,t,n),o=yield this.cache.getHeader(this.source);if(e<o.minZoom||e>o.maxZoom)return;let s=o.rootDirectoryOffset,f=o.rootDirectoryLength;for(let c=0;c<=3;c++){let u=yield this.cache.getDirectory(this.source,s,f,o),l=Ae(u,a);if(l){if(l.runLength>0){let h=yield this.source.getBytes(o.tileDataOffset+l.offset,l.length,i,o.etag);return{data:yield this.decompress(h.data,o.tileCompression),cacheControl:h.cacheControl,expires:h.expires}}s=o.leafDirectoryOffset+l.offset,f=l.length}else return}throw new Error("Maximum directory depth exceeded")})}getZxy(e,t,n,i){return m(this,null,function*(){try{return yield this.getZxyAttempt(e,t,n,i)}catch(a){if(a instanceof X)return this.cache.invalidate(this.source),yield this.getZxyAttempt(e,t,n,i);throw a}})}getMetadataAttempt(){return m(this,null,function*(){let e=yield this.cache.getHeader(this.source),t=yield this.source.getBytes(e.jsonMetadataOffset,e.jsonMetadataLength,void 0,e.etag),n=yield this.decompress(t.data,e.internalCompression),i=new TextDecoder("utf-8");return JSON.parse(i.decode(n))})}getMetadata(){return m(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(e){if(e instanceof X)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw e}})}getTileJson(e){return m(this,null,function*(){let t=yield this.getHeader(),n=yield this.getMetadata(),i=Me(t.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${e}/{z}/{x}/{y}${i}`],vector_layers:n.vector_layers,attribution:n.attribution,description:n.description,name:n.name,version:n.version,bounds:[t.minLon,t.minLat,t.maxLon,t.maxLat],center:[t.centerLon,t.centerLat,t.centerZoom],minzoom:t.minZoom,maxzoom:t.maxZoom}})}};d(Ze,"PMTiles");var ve=Ze;export{yt as S};
